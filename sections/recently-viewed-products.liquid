{% comment %}
  Recently Viewed Products Section
{% endcomment %}

{% schema %}
{
  "name": "Recently Viewed Products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Recently Viewed Products"
    },
    {
      "type": "range",
      "id": "max_products",
      "label": "Maximum Number of Products",
      "default": 4,
      "min": 1,
      "max": 10,
      "step": 1,
      "unit": "products"
    }
  ],
  "presets": [
    {
      "name": "Recently Viewed Products",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<div class="recently-viewed-products">
  <h2>{{ section.settings.heading }}</h2>
  <div class="product-grid">
    {% assign recently_viewed_products = [] %}

    <!-- Retrieve product handles stored in localStorage -->
    {% for item in content_for_header %}
      {% if item contains 'shopify.recentlyViewed' %}
        {% assign product_handles = item | split: 'shopify.recentlyViewed=' | last | split: '&' | first | split: ',' %}
      {% endif %}
    {% endfor %}

    <!-- Limit to maximum number of products set in schema -->
    {% assign max_products = section.settings.max_products %}
    {% assign product_count = 0 %}

    {% for handle in product_handles %}
      {% if product_count < max_products %}
        {% assign product = all_products[handle] %}

        <!-- Display product information -->
        <div class="product-item">
          <a href="{{ product.url }}">
            <img
              src="{{ product.featured_image | image_url: width: 200, height: 200, crop: 'center' }}"
              width="200"
              height="200"
              alt="{{ product.title }}"
            >
            <h3>{{ product.title }}</h3>
            <p>{{ product.price | money }}</p>
          </a>
        </div>

        {% assign product_count = product_count | plus: 1 %}
      {% endif %}
    {% endfor %}
  </div>
</div>

<!-- Add some basic styles -->
<style>
  .recently-viewed-products {
    padding: 20px;
    background-color: #f9f9f9;
  }
  .product-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }
  .product-item {
    flex: 1 1 calc(25% - 20px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 10px;
    text-align: center;
  }
  .product-item img {
    max-width: 100%;
    height: auto;
  }
</style>
